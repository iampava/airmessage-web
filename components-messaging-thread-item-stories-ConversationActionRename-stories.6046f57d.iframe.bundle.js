"use strict";(self.webpackChunkairmessage_react=self.webpackChunkairmessage_react||[]).push([[8083],{"./node_modules/@mui/material/esm/Typography/Typography.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>Typography_Typography});var objectWithoutPropertiesLoose=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js"),esm_extends=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/extends.js"),react=__webpack_require__("./node_modules/react/index.js"),clsx_m=__webpack_require__("./node_modules/clsx/dist/clsx.m.js"),extendSxProp=__webpack_require__("./node_modules/@mui/system/esm/styleFunctionSx/extendSxProp.js"),composeClasses=__webpack_require__("./node_modules/@mui/utils/esm/composeClasses/composeClasses.js"),styled=__webpack_require__("./node_modules/@mui/material/esm/styles/styled.js"),useThemeProps=__webpack_require__("./node_modules/@mui/material/esm/styles/useThemeProps.js"),capitalize=__webpack_require__("./node_modules/@mui/material/esm/utils/capitalize.js"),generateUtilityClass=__webpack_require__("./node_modules/@mui/utils/esm/generateUtilityClass/generateUtilityClass.js");function getTypographyUtilityClass(slot){return(0,generateUtilityClass.Z)("MuiTypography",slot)}(0,__webpack_require__("./node_modules/@mui/utils/esm/generateUtilityClasses/generateUtilityClasses.js").Z)("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const _excluded=["align","className","component","gutterBottom","noWrap","paragraph","variant","variantMapping"],TypographyRoot=(0,styled.ZP)("span",{name:"MuiTypography",slot:"Root",overridesResolver:(props,styles)=>{const{ownerState}=props;return[styles.root,ownerState.variant&&styles[ownerState.variant],"inherit"!==ownerState.align&&styles[`align${(0,capitalize.Z)(ownerState.align)}`],ownerState.noWrap&&styles.noWrap,ownerState.gutterBottom&&styles.gutterBottom,ownerState.paragraph&&styles.paragraph]}})((({theme,ownerState})=>(0,esm_extends.Z)({margin:0},ownerState.variant&&theme.typography[ownerState.variant],"inherit"!==ownerState.align&&{textAlign:ownerState.align},ownerState.noWrap&&{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},ownerState.gutterBottom&&{marginBottom:"0.35em"},ownerState.paragraph&&{marginBottom:16}))),defaultVariantMapping={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},colorTransformations={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},Typography_Typography=react.forwardRef((function Typography(inProps,ref){const themeProps=(0,useThemeProps.Z)({props:inProps,name:"MuiTypography"}),color=(color=>colorTransformations[color]||color)(themeProps.color),props=(0,extendSxProp.Z)((0,esm_extends.Z)({},themeProps,{color})),{align="inherit",className,component,gutterBottom=!1,noWrap=!1,paragraph=!1,variant="body1",variantMapping=defaultVariantMapping}=props,other=(0,objectWithoutPropertiesLoose.Z)(props,_excluded),ownerState=(0,esm_extends.Z)({},props,{align,color,className,component,gutterBottom,noWrap,paragraph,variant,variantMapping}),Component=component||(paragraph?"p":variantMapping[variant]||defaultVariantMapping[variant])||"span",classes=(ownerState=>{const{align,gutterBottom,noWrap,paragraph,variant,classes}=ownerState,slots={root:["root",variant,"inherit"!==ownerState.align&&`align${(0,capitalize.Z)(align)}`,gutterBottom&&"gutterBottom",noWrap&&"noWrap",paragraph&&"paragraph"]};return(0,composeClasses.Z)(slots,getTypographyUtilityClass,classes)})(ownerState);return(0,jsx_runtime.jsx)(TypographyRoot,(0,esm_extends.Z)({as:Component,ref,ownerState,className:(0,clsx_m.Z)(classes.root,className)},other))}))},"./node_modules/@mui/material/esm/utils/capitalize.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__=__webpack_require__("./node_modules/@mui/utils/esm/capitalize.js").Z},"./node_modules/@mui/utils/esm/composeClasses/composeClasses.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function composeClasses(slots,getUtilityClass,classes){const output={};return Object.keys(slots).forEach((slot=>{output[slot]=slots[slot].reduce(((acc,key)=>(key&&(acc.push(getUtilityClass(key)),classes&&classes[key]&&acc.push(classes[key])),acc)),[]).join(" ")})),output}__webpack_require__.d(__webpack_exports__,{Z:()=>composeClasses})},"./node_modules/@mui/utils/esm/generateUtilityClass/generateUtilityClass.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>generateUtilityClass});var _ClassNameGenerator__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@mui/utils/esm/ClassNameGenerator/ClassNameGenerator.js");const globalStateClassesMapping={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",required:"required",selected:"selected"};function generateUtilityClass(componentName,slot,globalStatePrefix="Mui"){const globalStateClass=globalStateClassesMapping[slot];return globalStateClass?`${globalStatePrefix}-${globalStateClass}`:`${_ClassNameGenerator__WEBPACK_IMPORTED_MODULE_0__.Z.generate(componentName)}-${slot}`}},"./node_modules/@mui/utils/esm/generateUtilityClasses/generateUtilityClasses.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>generateUtilityClasses});var _generateUtilityClass__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@mui/utils/esm/generateUtilityClass/generateUtilityClass.js");function generateUtilityClasses(componentName,slots,globalStatePrefix="Mui"){const result={};return slots.forEach((slot=>{result[slot]=(0,_generateUtilityClass__WEBPACK_IMPORTED_MODULE_0__.Z)(componentName,slot,globalStatePrefix)})),result}},"./src/components/messaging/thread/item/stories/ConversationActionRename.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ConversationActionRename:()=>ConversationActionRename,__namedExportsOrder:()=>__namedExportsOrder,default:()=>__WEBPACK_DEFAULT_EXPORT__});var _ConversationActionRename__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/components/messaging/thread/item/ConversationActionRename.tsx"),shared_data_stateCodes__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/data/stateCodes.ts");const __WEBPACK_DEFAULT_EXPORT__={title:"components/messaging/thread",component:_ConversationActionRename__WEBPACK_IMPORTED_MODULE_0__.Z},ConversationActionRename={args:{action:{date:new Date,chatName:"Chat name",itemType:shared_data_stateCodes__WEBPACK_IMPORTED_MODULE_1__.QN.ChatRenameAction,user:"Jon Doe",serverID:123,chatGuid:"guid",chatLocalID:22,guid:"guid",localID:12}}};ConversationActionRename.parameters={...ConversationActionRename.parameters,docs:{...ConversationActionRename.parameters?.docs,source:{originalSource:'{\n  args: {\n    action: {\n      date: new Date(),\n      chatName: "Chat name",\n      itemType: ConversationItemType.ChatRenameAction,\n      user: "Jon Doe",\n      serverID: 123,\n      chatGuid: "guid",\n      chatLocalID: 22,\n      guid: "guid",\n      localID: 12\n    }\n  }\n}',...ConversationActionRename.parameters?.docs?.source}}};const __namedExportsOrder=["ConversationActionRename"]},"./src/components/messaging/thread/item/ConversationActionLine.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>ConversationActionLine});__webpack_require__("./node_modules/react/index.js");var _mui_material__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@mui/material/esm/Typography/Typography.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js");function ConversationActionLine(props){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_mui_material__WEBPACK_IMPORTED_MODULE_2__.Z,{paddingTop:3,paddingBottom:1,paddingX:1,textAlign:"center",variant:"body2",color:"textSecondary",children:props.children})}ConversationActionLine.displayName="ConversationActionLine";try{ConversationActionLine.displayName="ConversationActionLine",ConversationActionLine.__docgenInfo={description:"",displayName:"ConversationActionLine",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/messaging/thread/item/ConversationActionLine.tsx#ConversationActionLine"]={docgenInfo:ConversationActionLine.__docgenInfo,name:"ConversationActionLine",path:"src/components/messaging/thread/item/ConversationActionLine.tsx#ConversationActionLine"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/messaging/thread/item/ConversationActionRename.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>ConversationActionRename});__webpack_require__("./node_modules/react/index.js");var _ConversationActionLine__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/components/messaging/thread/item/ConversationActionLine.tsx"),shared_util_hookUtils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/util/hookUtils.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js");function ConversationActionRename(props){const userName=(0,shared_util_hookUtils__WEBPACK_IMPORTED_MODULE_2__.em)(props.action.user);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_ConversationActionLine__WEBPACK_IMPORTED_MODULE_3__.Z,{children:generateMessage(userName,props.action.chatName)})}function generateMessage(user,title){return user?title?`${user} named the conversation "${title}"`:`${user} removed the conversation name`:title?`You named the conversation "${title}"`:"You removed the conversation name"}ConversationActionRename.displayName="ConversationActionRename";try{ConversationActionRename.displayName="ConversationActionRename",ConversationActionRename.__docgenInfo={description:"",displayName:"ConversationActionRename",props:{action:{defaultValue:null,description:"",name:"action",required:!0,type:{name:"ChatRenameAction"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/messaging/thread/item/ConversationActionRename.tsx#ConversationActionRename"]={docgenInfo:ConversationActionRename.__docgenInfo,name:"ConversationActionRename",path:"src/components/messaging/thread/item/ConversationActionRename.tsx#ConversationActionRename"})}catch(__react_docgen_typescript_loader_error){}},"./src/interface/people/peopleUtils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{D:()=>AddressType,b:()=>PeopleNoPermissionError});let AddressType=function(AddressType){return AddressType.Email="email",AddressType.Phone="phone",AddressType}({});class PeopleNoPermissionError extends Error{}},"./src/state/peopleState.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>PeopleContext});var shared_interface_people_peopleUtils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/interface/people/peopleUtils.ts"),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),shared_util_conversationUtils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/util/conversationUtils.ts"),libphonenumber_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/libphonenumber-js/min/exports/parsePhoneNumberFromString.js"),shared_util_hookUtils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/util/hookUtils.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js");const PeopleContext=react__WEBPACK_IMPORTED_MODULE_0__.createContext({needsPermission:!1,getPerson:()=>{},allPeople:void 0});function PeopleContextProvider(props){const[needsPermission,setNeedsPermission]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1),[peopleData,setPeopleData]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(void 0),ready=props.ready;(0,shared_util_hookUtils__WEBPACK_IMPORTED_MODULE_2__.Ev)((addPromise=>{ready&&addPromise(async function gapiLoadPeople(){const personArray=[],contactMap=new Map;let nextPageToken,requestIndex=0;do{requestIndex>0&&requestIndex%2==0&&await new Promise((r=>setTimeout(r,1e3)));const parameters={resourceName:"people/me",personFields:"names,photos,emailAddresses,phoneNumbers",pageToken:nextPageToken,pageSize:1e3,sortOrder:"FIRST_NAME_ASCENDING",sources:["READ_SOURCE_TYPE_CONTACT"]};let response;try{response=await gapi.client.people.people.connections.list(parameters)}catch(error){const response=error;throw 401===response.status||403===response.status?new shared_interface_people_peopleUtils__WEBPACK_IMPORTED_MODULE_3__.b:new GAPIPeopleError(response)}if(!response.result.connections)break;for(const person of response.result.connections){const personData=googlePersonToPersonData(person);personArray.push(personData);for(const address of personData.addresses)contactMap.has(address.value)||contactMap.set(address.value,personData)}nextPageToken=response.result.nextPageToken,console.log("Loaded contacts request index "+requestIndex+" / "+nextPageToken),requestIndex++}while(nextPageToken);return{personArray,personMap:contactMap}}()).then(setPeopleData).catch((error=>{error instanceof shared_interface_people_peopleUtils__WEBPACK_IMPORTED_MODULE_3__.b?setNeedsPermission(!0):console.warn(`Failed to load people: ${error}`)}))}),[ready,setPeopleData]);const getPerson=(0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((address=>{if(void 0===peopleData)return;let formattedAddress=address;if(!address.includes("@")){const phone=(0,libphonenumber_js__WEBPACK_IMPORTED_MODULE_4__._)(address);void 0!==phone&&(formattedAddress=phone.number.toString())}return peopleData.personMap.get(formattedAddress)}),[peopleData]);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(PeopleContext.Provider,{value:{needsPermission,getPerson,allPeople:peopleData?.personArray},children:props.children})}PeopleContextProvider.displayName="PeopleContextProvider";class GAPIPeopleError extends Error{constructor(response){super(response.body),this.response=response}}function googlePersonToPersonData(person){const id=person.resourceName,name=person.names?.[0].displayName,avatar=person.photos?.[0]?.url;return{id,name,avatar,addresses:[...person.emailAddresses?.reduce(((accumulator,address)=>(void 0!==address.value&&accumulator.push({value:address.value,displayValue:address.value,label:address.formattedType,type:shared_interface_people_peopleUtils__WEBPACK_IMPORTED_MODULE_3__.D.Email}),accumulator)),[])??[],...person.phoneNumbers?.reduce(((accumulator,address)=>(void 0!==address.canonicalForm&&accumulator.push({value:address.canonicalForm,displayValue:(0,shared_util_conversationUtils__WEBPACK_IMPORTED_MODULE_5__.Tg)(address.canonicalForm),label:address.formattedType,type:shared_interface_people_peopleUtils__WEBPACK_IMPORTED_MODULE_3__.D.Phone}),accumulator)),[])??[]]}}try{PeopleContextProvider.displayName="PeopleContextProvider",PeopleContextProvider.__docgenInfo={description:"",displayName:"PeopleContextProvider",props:{ready:{defaultValue:null,description:"",name:"ready",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/state/peopleState.tsx#PeopleContextProvider"]={docgenInfo:PeopleContextProvider.__docgenInfo,name:"PeopleContextProvider",path:"src/state/peopleState.tsx#PeopleContextProvider"})}catch(__react_docgen_typescript_loader_error){}},"./src/util/hookUtils.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Ev:()=>useCancellableEffect,ZM:()=>useIsFaceTimeSupported,b8:()=>useUnsubscribeContainer,em:()=>usePersonName,fu:()=>useNonNullableCacheState,q3:()=>usePersonData,vU:()=>useConversationTitle,vf:()=>useBlobURL});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),shared_connection_connectionManager__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/connection/connectionManager.ts"),_conversationUtils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/util/conversationUtils.ts"),shared_state_peopleState__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/state/peopleState.tsx");function useBlobURL(data,type){const[imageURL,setImageURL]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(void 0);return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>{const imageURL=URL.createObjectURL(new Blob([data],{type}));return setImageURL(imageURL),()=>{URL.revokeObjectURL(imageURL),setImageURL(void 0)}}),[data,type,setImageURL]),imageURL}function useNonNullableCacheState(...args){const initialState=args[0];let initialCacheState;initialCacheState=1===args.length?args[0]:args[1];const[value,setValue]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(initialState),[cacheValue,setCacheValue]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(initialCacheState),deferredValue=(0,react__WEBPACK_IMPORTED_MODULE_0__.useDeferredValue)(value);return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>{deferredValue&&setCacheValue(deferredValue)}),[deferredValue,setCacheValue]),[value,cacheValue,setValue]}function useCancellableEffect(effect,deps){(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>{let isCancelled=!1;const cleanup=effect((promise=>new Promise(((resolve,reject)=>{promise.then((val=>!isCancelled&&resolve(val))).catch((error=>!isCancelled&&reject(error)))}))));return()=>{isCancelled=!0,cleanup?.()}}),deps)}function useUnsubscribeContainer(deps){const callbackCollection=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(new Set).current;return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>()=>{for(const unsubscribe of callbackCollection)unsubscribe();callbackCollection.clear()}),deps),callback=>{callbackCollection.add(callback)}}function useIsFaceTimeSupported(){const[isFaceTimeSupported,setIsFaceTimeSupported]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(!1);return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((()=>(shared_connection_connectionManager__WEBPACK_IMPORTED_MODULE_1__.UB.subscribe(setIsFaceTimeSupported),()=>shared_connection_connectionManager__WEBPACK_IMPORTED_MODULE_1__.UB.unsubscribe(setIsFaceTimeSupported))),[setIsFaceTimeSupported]),isFaceTimeSupported}function useConversationTitle(conversation){const peopleState=(0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(shared_state_peopleState__WEBPACK_IMPORTED_MODULE_2__.A);return(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)((()=>void 0!==conversation.name&&conversation.name.length>0?conversation.name:(0,_conversationUtils__WEBPACK_IMPORTED_MODULE_3__.As)(conversation.members,peopleState)),[conversation,peopleState])}function usePersonData(address){const peopleState=(0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(shared_state_peopleState__WEBPACK_IMPORTED_MODULE_2__.A);return(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)((()=>{if(void 0!==address)return peopleState.getPerson(address)}),[address,peopleState])}function usePersonName(address){return usePersonData(address)?.name??address}}}]);