"use strict";(self.webpackChunkairmessage_react=self.webpackChunkairmessage_react||[]).push([[4814],{"./src/components/messaging/thread/stories/MessageList.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{MessageList:()=>MessageList,__namedExportsOrder:()=>__namedExportsOrder,default:()=>__WEBPACK_DEFAULT_EXPORT__});var _MessageList__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/components/messaging/thread/MessageList.tsx"),shared_data_stateCodes__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/data/stateCodes.ts");const __WEBPACK_DEFAULT_EXPORT__={title:"components/messaging/thread",component:_MessageList__WEBPACK_IMPORTED_MODULE_0__.Z},MessageList={args:{items:[{attachments:[],guid:"guid",status:shared_data_stateCodes__WEBPACK_IMPORTED_MODULE_1__.Bu.Read,date:new Date,stickers:[],tapbacks:[],text:"Message",sender:"Bill Smith",itemType:shared_data_stateCodes__WEBPACK_IMPORTED_MODULE_1__.QN.Message},{attachments:[],guid:"guid",status:shared_data_stateCodes__WEBPACK_IMPORTED_MODULE_1__.Bu.Read,date:new Date(Date.now()-36e5),stickers:[],tapbacks:[],text:"Message 2",sender:"Jon Doe",itemType:shared_data_stateCodes__WEBPACK_IMPORTED_MODULE_1__.QN.Message},{attachments:[],guid:"guid",status:shared_data_stateCodes__WEBPACK_IMPORTED_MODULE_1__.Bu.Read,date:new Date(Date.now()-36e5),stickers:[],tapbacks:[],text:"Message 33",itemType:shared_data_stateCodes__WEBPACK_IMPORTED_MODULE_1__.QN.Message}],conversation:{guid:"guid",localID:12,members:["Jon Doe","Bill Smith"],service:"iMessage",name:"Conversation Name",preview:{date:new Date,attachments:[],text:"Preview",type:shared_data_stateCodes__WEBPACK_IMPORTED_MODULE_1__.mZ.Message},unreadMessages:!0,localOnly:!1},messageSubmitEmitter:{unsubscribe:()=>{},subscribe:()=>{}}}};MessageList.parameters={...MessageList.parameters,docs:{...MessageList.parameters?.docs,source:{originalSource:'{\n  args: {\n    items: [{\n      attachments: [],\n      guid: "guid",\n      status: MessageStatusCode.Read,\n      date: new Date(),\n      stickers: [],\n      tapbacks: [],\n      text: "Message",\n      sender: "Bill Smith",\n      itemType: ConversationItemType.Message\n    }, {\n      attachments: [],\n      guid: "guid",\n      status: MessageStatusCode.Read,\n      date: new Date(Date.now() - 60 * 60 * 1000),\n      stickers: [],\n      tapbacks: [],\n      text: "Message 2",\n      sender: "Jon Doe",\n      itemType: ConversationItemType.Message\n    }, {\n      attachments: [],\n      guid: "guid",\n      status: MessageStatusCode.Read,\n      date: new Date(Date.now() - 60 * 60 * 1000),\n      stickers: [],\n      tapbacks: [],\n      text: "Message 33",\n      itemType: ConversationItemType.Message\n    }],\n    conversation: {\n      guid: "guid",\n      localID: 12,\n      members: ["Jon Doe", "Bill Smith"],\n      service: "iMessage",\n      name: "Conversation Name",\n      preview: {\n        date: new Date(),\n        attachments: [],\n        text: "Preview",\n        type: ConversationPreviewType.Message\n      },\n      unreadMessages: true,\n      localOnly: false\n    },\n    messageSubmitEmitter: {\n      unsubscribe: () => {},\n      subscribe: () => {}\n    }\n  }\n}',...MessageList.parameters?.docs?.source}}};const __namedExportsOrder=["MessageList"]},"./src/components/messaging/thread/MessageList.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>MessageList});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_mui_material__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@mui/material/esm/Box/Box.js"),_mui_material__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@mui/material/esm/Stack/Stack.js"),_mui_material__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@mui/material/esm/CircularProgress/CircularProgress.js"),_item_Message__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/components/messaging/thread/item/Message.tsx"),_util_conversationUtils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./src/util/conversationUtils.ts"),_data_stateCodes__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/data/stateCodes.ts"),_item_ConversationActionParticipant__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/components/messaging/thread/item/ConversationActionParticipant.tsx"),_item_ConversationActionRename__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./src/components/messaging/thread/item/ConversationActionRename.tsx"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js");class MessageList extends react__WEBPACK_IMPORTED_MODULE_0__.Component{state={isInThreshold:!1};scrollRef=react__WEBPACK_IMPORTED_MODULE_0__.createRef();snapshotScrollHeight=0;snapshotScrollTop=0;shouldScrollNextUpdate=!1;handleScroll=event=>{event.currentTarget.scrollTop<300?this.state.isInThreshold||(this.setState({isInThreshold:!0}),this.props.onRequestHistory()):this.state.isInThreshold&&this.setState({isInThreshold:!1})};render(){const readTargetIndex=this.props.items.findIndex((item=>item.itemType===_data_stateCodes__WEBPACK_IMPORTED_MODULE_2__.QN.Message&&void 0===item.sender&&item.status===_data_stateCodes__WEBPACK_IMPORTED_MODULE_2__.Bu.Read)),deliveredTargetIndex=this.props.items.slice(0,-1===readTargetIndex?void 0:readTargetIndex).findIndex((item=>item.itemType===_data_stateCodes__WEBPACK_IMPORTED_MODULE_2__.QN.Message&&void 0===item.sender&&item.status===_data_stateCodes__WEBPACK_IMPORTED_MODULE_2__.Bu.Delivered));return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_mui_material__WEBPACK_IMPORTED_MODULE_3__.Z,{sx:{width:"100%",flexGrow:1,minHeight:0,padding:2,overflowX:"hidden",overflowY:"scroll",scrollBehavior:"smooth"},ref:this.scrollRef,onScroll:this.handleScroll,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsxs)(_mui_material__WEBPACK_IMPORTED_MODULE_4__.Z,{sx:{width:"100%",maxWidth:"1000px",marginX:"auto"},direction:"column-reverse",children:[this.props.items.map(((item,i,array)=>item.itemType===_data_stateCodes__WEBPACK_IMPORTED_MODULE_2__.QN.Message?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_item_Message__WEBPACK_IMPORTED_MODULE_5__.Z,{message:item,isGroupChat:this.props.conversation.members.length>1,service:this.props.conversation.service,flow:(0,_util_conversationUtils__WEBPACK_IMPORTED_MODULE_6__.If)(item,array[i+1],array[i-1]),showStatus:i===readTargetIndex||i===deliveredTargetIndex},item.localID??item.guid):item.itemType===_data_stateCodes__WEBPACK_IMPORTED_MODULE_2__.QN.ParticipantAction?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_item_ConversationActionParticipant__WEBPACK_IMPORTED_MODULE_7__.Z,{action:item},item.localID??item.guid):item.itemType===_data_stateCodes__WEBPACK_IMPORTED_MODULE_2__.QN.ChatRenameAction?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_item_ConversationActionRename__WEBPACK_IMPORTED_MODULE_8__.Z,{action:item},item.localID??item.guid):null)),this.props.showHistoryLoader&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(HistoryLoadingProgress,{},"static-historyloader")]})})}componentDidMount(){this.props.messageSubmitEmitter.subscribe(this.onMessageSubmit),this.scrollToBottom(!0)}getSnapshotBeforeUpdate(){this.shouldScrollNextUpdate=this.checkScrolledToBottom();const element=this.scrollRef.current;return this.snapshotScrollHeight=element.scrollHeight,this.snapshotScrollTop=element.scrollTop,null}componentDidUpdate(prevProps){if(this.shouldScrollNextUpdate)this.scrollToBottom(),this.shouldScrollNextUpdate=!1;else if(this.props.showHistoryLoader!==prevProps.showHistoryLoader&&this.checkScrolledToTop()){const element=this.scrollRef.current;this.setScroll(this.snapshotScrollTop+(element.scrollHeight-this.snapshotScrollHeight),!0)}this.props.messageSubmitEmitter!==prevProps.messageSubmitEmitter&&(prevProps.messageSubmitEmitter.unsubscribe(this.onMessageSubmit),this.props.messageSubmitEmitter.subscribe(this.onMessageSubmit))}componentWillUnmount(){this.props.messageSubmitEmitter.unsubscribe(this.onMessageSubmit)}onMessageSubmit=()=>{setTimeout((()=>this.scrollToBottom()),0)};scrollToBottom(disableAnimation=!1){this.setScroll(this.scrollRef.current.scrollHeight,disableAnimation)}setScroll(scrollTop,disableAnimation=!1){const element=this.scrollRef.current;disableAnimation&&(element.style.scrollBehavior="auto"),element.scrollTop=scrollTop,disableAnimation&&(element.style.scrollBehavior="")}checkScrolledToBottom(){const element=this.scrollRef.current;return element.scrollHeight-element.scrollTop-element.clientHeight<=0}checkScrolledToTop(){return this.scrollRef.current.scrollTop<=0}}function HistoryLoadingProgress(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_mui_material__WEBPACK_IMPORTED_MODULE_3__.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_mui_material__WEBPACK_IMPORTED_MODULE_9__.Z,{})})}MessageList.displayName="MessageList",HistoryLoadingProgress.displayName="HistoryLoadingProgress";try{MessageList.displayName="MessageList",MessageList.__docgenInfo={description:"",displayName:"MessageList",props:{conversation:{defaultValue:null,description:"",name:"conversation",required:!0,type:{name:"Conversation"}},items:{defaultValue:null,description:"",name:"items",required:!0,type:{name:"ConversationItem[]"}},messageSubmitEmitter:{defaultValue:null,description:"",name:"messageSubmitEmitter",required:!0,type:{name:"EventEmitter<void>"}},onRequestHistory:{defaultValue:null,description:"",name:"onRequestHistory",required:!0,type:{name:"() => void"}},showHistoryLoader:{defaultValue:null,description:"",name:"showHistoryLoader",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/messaging/thread/MessageList.tsx#MessageList"]={docgenInfo:MessageList.__docgenInfo,name:"MessageList",path:"src/components/messaging/thread/MessageList.tsx#MessageList"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/messaging/thread/item/ConversationActionLine.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>ConversationActionLine});__webpack_require__("./node_modules/react/index.js");var _mui_material__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@mui/material/esm/Typography/Typography.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js");function ConversationActionLine(props){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_mui_material__WEBPACK_IMPORTED_MODULE_2__.Z,{paddingTop:3,paddingBottom:1,paddingX:1,textAlign:"center",variant:"body2",color:"textSecondary",children:props.children})}ConversationActionLine.displayName="ConversationActionLine";try{ConversationActionLine.displayName="ConversationActionLine",ConversationActionLine.__docgenInfo={description:"",displayName:"ConversationActionLine",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/messaging/thread/item/ConversationActionLine.tsx#ConversationActionLine"]={docgenInfo:ConversationActionLine.__docgenInfo,name:"ConversationActionLine",path:"src/components/messaging/thread/item/ConversationActionLine.tsx#ConversationActionLine"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/messaging/thread/item/ConversationActionParticipant.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>ConversationActionParticipant});__webpack_require__("./node_modules/react/index.js");var _data_stateCodes__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/data/stateCodes.ts"),_ConversationActionLine__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/components/messaging/thread/item/ConversationActionLine.tsx"),shared_util_hookUtils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/util/hookUtils.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js");function ConversationActionParticipant(props){const userName=(0,shared_util_hookUtils__WEBPACK_IMPORTED_MODULE_2__.em)(props.action.user),targetName=(0,shared_util_hookUtils__WEBPACK_IMPORTED_MODULE_2__.em)(props.action.target);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_ConversationActionLine__WEBPACK_IMPORTED_MODULE_3__.Z,{children:generateMessage(props.action.type,userName,targetName)})}function generateMessage(type,user,target){if(type===_data_stateCodes__WEBPACK_IMPORTED_MODULE_4__.rk.Join){if(user===target)return user?`${user} joined the conversation`:"You joined the conversation";if(user&&target)return`${user} added ${target} to the conversation`;if(user)return`${user} added you to the conversation`;if(target)return`You added ${target} to the conversation`}else if(type===_data_stateCodes__WEBPACK_IMPORTED_MODULE_4__.rk.Leave){if(user===target)return user?`${user} left the conversation`:"You left the conversation";if(user&&target)return`${user} removed ${target} from the conversation`;if(user)return`${user} removed you from the conversation`;if(target)return`You removed ${target} from the conversation`}return"Unknown event"}ConversationActionParticipant.displayName="ConversationActionParticipant";try{ConversationActionParticipant.displayName="ConversationActionParticipant",ConversationActionParticipant.__docgenInfo={description:"",displayName:"ConversationActionParticipant",props:{action:{defaultValue:null,description:"",name:"action",required:!0,type:{name:"ParticipantAction"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/messaging/thread/item/ConversationActionParticipant.tsx#ConversationActionParticipant"]={docgenInfo:ConversationActionParticipant.__docgenInfo,name:"ConversationActionParticipant",path:"src/components/messaging/thread/item/ConversationActionParticipant.tsx#ConversationActionParticipant"})}catch(__react_docgen_typescript_loader_error){}},"./src/components/messaging/thread/item/ConversationActionRename.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>ConversationActionRename});__webpack_require__("./node_modules/react/index.js");var _ConversationActionLine__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/components/messaging/thread/item/ConversationActionLine.tsx"),shared_util_hookUtils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/util/hookUtils.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js");function ConversationActionRename(props){const userName=(0,shared_util_hookUtils__WEBPACK_IMPORTED_MODULE_2__.em)(props.action.user);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(_ConversationActionLine__WEBPACK_IMPORTED_MODULE_3__.Z,{children:generateMessage(userName,props.action.chatName)})}function generateMessage(user,title){return user?title?`${user} named the conversation "${title}"`:`${user} removed the conversation name`:title?`You named the conversation "${title}"`:"You removed the conversation name"}ConversationActionRename.displayName="ConversationActionRename";try{ConversationActionRename.displayName="ConversationActionRename",ConversationActionRename.__docgenInfo={description:"",displayName:"ConversationActionRename",props:{action:{defaultValue:null,description:"",name:"action",required:!0,type:{name:"ChatRenameAction"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/messaging/thread/item/ConversationActionRename.tsx#ConversationActionRename"]={docgenInfo:ConversationActionRename.__docgenInfo,name:"ConversationActionRename",path:"src/components/messaging/thread/item/ConversationActionRename.tsx#ConversationActionRename"})}catch(__react_docgen_typescript_loader_error){}}}]);